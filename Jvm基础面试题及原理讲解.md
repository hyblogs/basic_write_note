## JVMåŸºç¡€é¢è¯•é¢˜åŠåŸç†è®²è§£
> åŸæ–‡å‡ºå¤„ï¼šhttp://www.importnew.com/31126.html

> æœ¬æ–‡ä» JVM ç»“æ„å…¥æ‰‹ï¼Œä»‹ç»äº† Java å†…å­˜ç®¡ç†ã€å¯¹è±¡åˆ›å»ºã€å¸¸é‡æ± ç­‰åŸºç¡€çŸ¥è¯†ï¼Œå¯¹é¢è¯•ä¸­ JVM ç›¸å…³çš„åŸºç¡€é¢˜ç›®è¿›è¡Œäº†è®²è§£ã€‚

<!--ç›®å½•ç»“æ„-->
[toc]

## å†™åœ¨å‰é¢ï¼ˆå¸¸è§é¢è¯•é¢˜ï¼‰  

> **åŸºæœ¬é—®é¢˜**  
1.ä»‹ç»ä¸‹ Java å†…å­˜åŒºåŸŸï¼ˆè¿è¡Œæ—¶æ•°æ®åŒºï¼‰  
2.Java å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼ˆäº”æ­¥ï¼Œå»ºè®®èƒ½é»˜å†™å‡ºæ¥å¹¶ä¸”è¦çŸ¥é“æ¯ä¸€æ­¥è™šæ‹Ÿæœºåšäº†ä»€ä¹ˆï¼‰  
3.å¯¹è±¡çš„è®¿é—®å®šä½çš„ä¸¤ç§æ–¹å¼ï¼ˆå¥æŸ„å’Œç›´æ¥æŒ‡é’ˆä¸¤ç§æ–¹å¼ï¼‰  

> **æ‹“å±•é—®é¢˜**  
1.Stringç±»å’Œå¸¸é‡æ± 
2.8ç§åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å’Œå¸¸é‡æ± 

## 1 æ¦‚è¿° 
> å¯¹äº Java ç¨‹åºå‘˜æ¥è¯´ï¼Œåœ¨è™šæ‹Ÿæœºè‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶ä¸‹ï¼Œä¸å†éœ€è¦åƒC/C++ç¨‹åºå¼€å‘ç¨‹åºå‘˜è¿™æ ·ä¸ºå†…ä¸€ä¸ª new æ“ä½œå»å†™å¯¹åº”çš„ delete/free æ“ä½œï¼Œä¸å®¹æ˜“å‡ºç°å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºé—®é¢˜ã€‚æ­£æ˜¯å› ä¸º Java ç¨‹åºå‘˜æŠŠå†…å­˜æ§åˆ¶æƒåˆ©äº¤ç»™ Java è™šæ‹Ÿæœºï¼Œä¸€æ—¦å‡ºç°å†…å­˜æ³„æ¼å’Œæº¢å‡ºæ–¹é¢çš„é—®é¢˜ï¼Œå¦‚æœä¸äº†è§£è™šæ‹Ÿæœºæ˜¯æ€æ ·ä½¿ç”¨å†…å­˜çš„ï¼Œé‚£ä¹ˆæ’æŸ¥é”™è¯¯å°†ä¼šæ˜¯ä¸€ä¸ªéå¸¸è‰°å·¨çš„ä»»åŠ¡ã€‚

## 2 è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ 
> Java è™šæ‹Ÿæœºåœ¨æ‰§è¡Œ Java ç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠå®ƒç®¡ç†çš„å†…å­˜åˆ’åˆ†æˆè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸã€‚
![avatar](https://github.com/hyblogs/blogs/blob/master/Java_Images/Interview_Base/01.jpg)

> è¿™äº›ç»„æˆéƒ¨åˆ†ä¸€äº›æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå…¶ä»–çš„åˆ™æ˜¯çº¿ç¨‹å…±äº«çš„ã€‚

> *çº¿ç¨‹ç§æœ‰çš„*ï¼š

> (1).ç¨‹åºè®¡æ•°å™¨.  
> (2).è™šæ‹Ÿæœºæ ˆ.  
> (3).æœ¬åœ°æ–¹æ³•æ ˆ.  

> *çº¿ç¨‹å…±äº«çš„*ï¼š

> (1).å †.  
> (2).æ–¹æ³•åŒº.  
> (3).ç›´æ¥å†…å­˜.  

### 2.1 ç¨‹åºè®¡æ•°å™¨
> ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚å­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œã€‚

> å¦å¤–ï¼Œä¸ºäº†çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œæ¯æ¡çº¿ç¨‹éƒ½éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå„çº¿ç¨‹ä¹‹é—´è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ï¼Œæˆ‘ä»¬ç§°è¿™ç±»å†…å­˜åŒºåŸŸä¸ºâ€œçº¿ç¨‹ç§æœ‰â€çš„å†…å­˜ã€‚

> **ä»ä¸Šé¢çš„ä»‹ç»ä¸­æˆ‘ä»¬çŸ¥é“ç¨‹åºè®¡æ•°å™¨ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼š**

> 1.å­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨æ¥ä¾æ¬¡è¯»å–æŒ‡ä»¤ï¼Œä»è€Œå®ç°ä»£ç çš„æµç¨‹æ§åˆ¶ï¼Œå¦‚ï¼šé¡ºåºæ‰§è¡Œã€é€‰æ‹©ã€å¾ªç¯ã€å¼‚å¸¸å¤„ç†ã€‚  
> 2.åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œç¨‹åºè®¡æ•°å™¨ç”¨äºè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®ï¼Œä»è€Œå½“çº¿ç¨‹è¢«åˆ‡æ¢å›æ¥çš„æ—¶å€™èƒ½å¤ŸçŸ¥é“è¯¥çº¿ç¨‹ä¸Šæ¬¡è¿è¡Œåˆ°å“ªå„¿äº†ã€‚
> **æ³¨æ„**ï¼šç¨‹åºè®¡æ•°å™¨æ˜¯å”¯ä¸€ä¸ä¼šå‡ºç° OutOfMemoryError çš„å†…å­˜åŒºåŸŸï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚

### 2.2 Java è™šæ‹Ÿæœºæ ˆ
> ä¸ç¨‹åºè®¡æ•°å™¨ä¸€æ ·ï¼ŒJavaè™šæ‹Ÿæœºæ ˆä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ç›¸åŒï¼Œæè¿°çš„æ˜¯ Java æ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ã€‚

> Java å†…å­˜å¯ä»¥ç²—ç³™çš„åŒºåˆ†ä¸ºå †å†…å­˜ï¼ˆHeapï¼‰å’Œæ ˆå†…å­˜ï¼ˆStackï¼‰å…¶ä¸­æ ˆå°±æ˜¯ç°åœ¨è¯´çš„è™šæ‹Ÿæœºæ ˆï¼Œæˆ–è€…è¯´æ˜¯è™šæ‹Ÿæœºæ ˆä¸­å±€éƒ¨å˜é‡è¡¨éƒ¨åˆ†ã€‚ ï¼ˆå®é™…ä¸Šï¼ŒJavaè™šæ‹Ÿæœºæ ˆæ˜¯ç”±ä¸€ä¸ªä¸ªæ ˆå¸§ç»„æˆï¼Œè€Œæ¯ä¸ªæ ˆå¸§ä¸­éƒ½æ‹¥æœ‰å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ä¿¡æ¯ï¼‰

> å±€éƒ¨å˜é‡è¡¨ä¸»è¦å­˜æ”¾äº†ç¼–è¯‘å™¨å¯çŸ¥çš„å„ç§æ•°æ®ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€å¯¹è±¡å¼•ç”¨ï¼ˆreferenceç±»å‹ï¼Œå®ƒä¸åŒäºå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ï¼‰ã€‚

> **Java è™šæ‹Ÿæœºæ ˆä¼šå‡ºç°ä¸¤ç§å¼‚å¸¸ï¼šStackOverFlowError å’Œ OutOfMemoryErrorã€‚**

> *StackOverFlowErrorï¼š è‹¥Javaè™šæ‹Ÿæœºæ ˆçš„å†…å­˜å¤§å°ä¸å…è®¸åŠ¨æ€æ‰©å±•ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹è¯·æ±‚æ ˆçš„æ·±åº¦è¶…è¿‡å½“å‰Javaè™šæ‹Ÿæœºæ ˆçš„æœ€å¤§æ·±åº¦çš„æ—¶å€™ï¼Œå°±æŠ›å‡ºStackOverFlowErrorå¼‚å¸¸ã€‚  
> *OutOfMemoryErrorï¼š è‹¥ Java è™šæ‹Ÿæœºæ ˆçš„å†…å­˜å¤§å°å…è®¸åŠ¨æ€æ‰©å±•ï¼Œä¸”å½“çº¿ç¨‹è¯·æ±‚æ ˆæ—¶å†…å­˜ç”¨å®Œäº†ï¼Œæ— æ³•å†åŠ¨æ€æ‰©å±•äº†ï¼Œæ­¤æ—¶æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚  

> Java è™šæ‹Ÿæœºæ ˆä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å„è‡ªçš„Javaè™šæ‹Ÿæœºæ ˆï¼Œè€Œä¸”éšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„æ­»äº¡è€Œæ­»äº¡ã€‚

### 2.3 æœ¬åœ°æ–¹æ³•æ ˆ
> å’Œè™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«æ˜¯ï¼š è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œ Java æ–¹æ³• ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ Native æ–¹æ³•æœåŠ¡ã€‚ åœ¨ HotSpot è™šæ‹Ÿæœºä¸­å’Œ Java è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚

> æœ¬åœ°æ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œåœ¨æœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜æ”¾è¯¥æœ¬åœ°æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€å‡ºå£ä¿¡æ¯ã€‚

> æ–¹æ³•æ‰§è¡Œå®Œæ¯•åç›¸åº”çš„æ ˆå¸§ä¹Ÿä¼šå‡ºæ ˆå¹¶é‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œä¹Ÿä¼šå‡ºç° StackOverFlowError å’Œ OutOfMemoryError ä¸¤ç§å¼‚å¸¸ã€‚

### 2.4 å †
> Java å †æ˜¯ Java è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼ŒJava å †æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚

> Java å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œGCå †ï¼ˆGarbage Collected Heapï¼‰.ä»åƒåœ¾å›æ”¶çš„è§’åº¦ï¼Œç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½é‡‡ç”¨åˆ†ä»£åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥Javaå †è¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼šå†ç»†è‡´ä¸€ç‚¹æœ‰ï¼šEdenç©ºé—´ã€From Survivorã€To Survivorç©ºé—´ç­‰ã€‚è¿›ä¸€æ­¥åˆ’åˆ†çš„ç›®çš„æ˜¯æ›´å¥½åœ°å›æ”¶å†…å­˜ï¼Œæˆ–è€…æ›´å¿«åœ°åˆ†é…å†…å­˜ã€‚
![avatar](https://github.com/hyblogs/blogs/blob/master/Java_Images/Interview_Base/02.png)

> åœ¨ JDK 1.8ä¸­ç§»é™¤æ•´ä¸ªæ°¸ä¹…ä»£ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸€ä¸ªå«å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰çš„åŒºåŸŸï¼ˆæ°¸ä¹…ä»£ä½¿ç”¨çš„æ˜¯JVMçš„å †å†…å­˜ç©ºé—´ï¼Œè€Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯ç‰©ç†å†…å­˜ï¼Œç›´æ¥å—åˆ°æœ¬æœºçš„ç‰©ç†å†…å­˜é™åˆ¶ï¼‰ã€‚

> æ¨èé˜…è¯»ï¼š[Java8å†…å­˜æ¨¡å‹â€”â€”æ°¸ä¹…ä»£ï¼ˆPermGenï¼‰å’Œå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰](#toc_18)

### 2.5 æ–¹æ³•åŒº
> æ–¹æ³•åŒºä¸ Java å †ä¸€æ ·ï¼Œæ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚è™½ç„¶Javaè™šæ‹Ÿæœºè§„èŒƒæŠŠæ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒå´æœ‰ä¸€ä¸ªåˆ«åå«åš Non-Heapï¼ˆéå †ï¼‰ï¼Œç›®çš„åº”è¯¥æ˜¯ä¸ Java å †åŒºåˆ†å¼€æ¥ã€‚

> HotSpot è™šæ‹Ÿæœºä¸­æ–¹æ³•åŒºä¹Ÿå¸¸è¢«ç§°ä¸º â€œæ°¸ä¹…ä»£â€ï¼Œæœ¬è´¨ä¸Šä¸¤è€…å¹¶ä¸ç­‰ä»·ã€‚ä»…ä»…æ˜¯å› ä¸º HotSpot è™šæ‹Ÿæœºè®¾è®¡å›¢é˜Ÿç”¨æ°¸ä¹…ä»£æ¥å®ç°æ–¹æ³•åŒºè€Œå·²ï¼Œè¿™æ · HotSpot è™šæ‹Ÿæœºçš„åƒåœ¾æ”¶é›†å™¨å°±å¯ä»¥åƒç®¡ç† Java å †ä¸€æ ·ç®¡ç†è¿™éƒ¨åˆ†å†…å­˜äº†ã€‚ä½†æ˜¯è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºè¿™æ ·æ›´å®¹æ˜“é‡åˆ°å†…å­˜æº¢å‡ºé—®é¢˜ã€‚

> ç›¸å¯¹è€Œè¨€ï¼Œåƒåœ¾æ”¶é›†è¡Œä¸ºåœ¨è¿™ä¸ªåŒºåŸŸæ˜¯æ¯”è¾ƒå°‘å‡ºç°çš„ï¼Œä½†å¹¶éæ•°æ®è¿›å…¥æ–¹æ³•åŒºåå°±â€œæ°¸ä¹…å­˜åœ¨â€äº†ã€‚

### 2.6 è¿è¡Œæ—¶å¸¸é‡æ± 
> è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚Class æ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰å¸¸é‡æ± ä¿¡æ¯ï¼ˆç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼‰
æ—¢ç„¶è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œè‡ªç„¶å—åˆ°æ–¹æ³•åŒºå†…å­˜çš„é™åˆ¶ï¼Œå½“å¸¸é‡æ± æ— æ³•å†ç”³è¯·åˆ°å†…å­˜æ—¶ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚

> JDK1.7åŠä¹‹åç‰ˆæœ¬çš„ JVM å·²ç»å°†è¿è¡Œæ—¶å¸¸é‡æ± ä»æ–¹æ³•åŒºä¸­ç§»äº†å‡ºæ¥ï¼Œåœ¨ Java å †ï¼ˆHeapï¼‰ä¸­å¼€è¾Ÿäº†ä¸€å—åŒºåŸŸå­˜æ”¾è¿è¡Œæ—¶å¸¸é‡æ± ã€‚
![avatar](https://github.com/hyblogs/blogs/blob/master/Java_Images/Interview_Base/03.jpg)


> æ¨èé˜…è¯»ï¼š[Java ä¸­å‡ ç§å¸¸é‡æ± çš„åŒºåˆ†](#toc_23)

### 2.7 ç›´æ¥å†…å­˜
> ç›´æ¥å†…å­˜å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸï¼Œä½†æ˜¯è¿™éƒ¨åˆ†å†…å­˜ä¹Ÿè¢«é¢‘ç¹åœ°ä½¿ç”¨ã€‚è€Œä¸”ä¹Ÿå¯èƒ½å¯¼è‡´OutOfMemoryErrorå¼‚å¸¸å‡ºç°ã€‚

> JDK1.4ä¸­æ–°åŠ å…¥çš„ NIO(New Input/Output) ç±»ï¼Œå¼•å…¥äº†ä¸€ç§åŸºäºé€šé“ï¼ˆChannelï¼‰ ä¸ç¼“å­˜åŒºï¼ˆBufferï¼‰ çš„ I/O æ–¹å¼ï¼Œå®ƒå¯ä»¥ç›´æ¥ä½¿ç”¨Nativeå‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨ Java å †ä¸­çš„ DirectByteBuffer å¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·å°±èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨ Java å †å’Œ Native å †ä¹‹é—´æ¥å›å¤åˆ¶æ•°æ®ã€‚

> æœ¬æœºç›´æ¥å†…å­˜çš„åˆ†é…ä¸ä¼šæ”¶åˆ° Java å †çš„é™åˆ¶ï¼Œä½†æ˜¯ï¼Œæ—¢ç„¶æ˜¯å†…å­˜å°±ä¼šå—åˆ°æœ¬æœºæ€»å†…å­˜å¤§å°ä»¥åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶ã€‚

## 3 HotSpot è™šæ‹Ÿæœºå¯¹è±¡æ¢ç§˜
> é€šè¿‡ä¸Šé¢çš„ä»‹ç»æˆ‘ä»¬å¤§æ¦‚çŸ¥é“äº†è™šæ‹Ÿæœºçš„å†…å­˜æƒ…å†µï¼Œä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†çš„äº†è§£ä¸€ä¸‹ HotSpot è™šæ‹Ÿæœºåœ¨ Java å †ä¸­å¯¹è±¡åˆ†é…ã€å¸ƒå±€å’Œè®¿é—®çš„å…¨è¿‡ç¨‹ã€‚

### 3.1 å¯¹è±¡çš„åˆ›å»º
> ä¸‹å›¾ä¾¿æ˜¯ Java å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œæˆ‘å»ºè®®æœ€å¥½æ˜¯èƒ½é»˜å†™å‡ºæ¥ï¼Œå¹¶ä¸”è¦æŒæ¡æ¯ä¸€æ­¥åœ¨åšä»€ä¹ˆã€‚
![avatar](https://github.com/hyblogs/blogs/blob/master/Java_Images/Interview_Base/04.jpg)


> _Javaåˆ›å»ºå¯¹è±¡è¿‡ç¨‹_  
> **1. ç±»åŠ è½½æ£€æŸ¥ï¼š** è™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡ new æŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆå°†å»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½è¿‡ã€è§£æå’Œåˆå§‹åŒ–è¿‡ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£å¿…é¡»å…ˆæ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹ã€‚

> **2. åˆ†é…å†…å­˜ï¼š** åœ¨ç±»åŠ è½½æ£€æŸ¥é€šè¿‡åï¼Œæ¥ä¸‹æ¥è™šæ‹Ÿæœºå°†ä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜ã€‚å¯¹è±¡æ‰€éœ€çš„å†…å­˜å¤§å°åœ¨ç±»åŠ è½½å®Œæˆåä¾¿å¯ç¡®å®šï¼Œä¸ºå¯¹è±¡åˆ†é…ç©ºé—´çš„ä»»åŠ¡ç­‰åŒäºæŠŠä¸€å—ç¡®å®šå¤§å°çš„å†…å­˜ä» Java å †ä¸­åˆ’åˆ†å‡ºæ¥ã€‚åˆ†é…æ–¹å¼æœ‰ â€œæŒ‡é’ˆç¢°æ’â€ å’Œ â€œç©ºé—²åˆ—è¡¨â€ ä¸¤ç§ï¼Œé€‰æ‹©å“ªç§åˆ†é…æ–¹å¼ç”± Java å †æ˜¯å¦è§„æ•´å†³å®šï¼Œè€ŒJavaå †æ˜¯å¦è§„æ•´åˆç”±æ‰€é‡‡ç”¨çš„åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰å‹ç¼©æ•´ç†åŠŸèƒ½å†³å®šã€‚

> **å†…å­˜åˆ†é…çš„ä¸¤ç§æ–¹å¼ï¼š**ï¼ˆè¡¥å……å†…å®¹ï¼Œéœ€è¦æŒæ¡ï¼‰

> é€‰æ‹©ä»¥ä¸Šä¸¤ç§æ–¹å¼ä¸­çš„å“ªä¸€ç§ï¼Œå–å†³äº Java å †å†…å­˜æ˜¯å¦è§„æ•´ã€‚è€Œ Java å †å†…å­˜æ˜¯å¦è§„æ•´ï¼Œå–å†³äº GC æ”¶é›†å™¨çš„ç®—æ³•æ˜¯â€æ ‡è®°-æ¸…é™¤â€ï¼Œè¿˜æ˜¯â€æ ‡è®°-æ•´ç†â€ï¼ˆä¹Ÿç§°ä½œâ€æ ‡è®°-å‹ç¼©â€ï¼‰ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¤åˆ¶ç®—æ³•å†…å­˜ä¹Ÿæ˜¯è§„æ•´çš„ã€‚
![avatar](https://github.com/hyblogs/blogs/blob/master/Java_Images/Interview_Base/05.png)


> **å†…å­˜åˆ†é…å¹¶å‘é—®é¢˜**ï¼ˆè¡¥å……å†…å®¹ï¼Œéœ€è¦æŒæ¡ï¼‰

> åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜ï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨ï¼Œå› ä¸ºåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåˆ›å»ºå¯¹è±¡æ˜¯å¾ˆé¢‘ç¹çš„äº‹æƒ…ï¼Œä½œä¸ºè™šæ‹Ÿæœºæ¥è¯´ï¼Œå¿…é¡»è¦ä¿è¯çº¿ç¨‹æ˜¯å®‰å…¨çš„ï¼Œé€šå¸¸æ¥è®²ï¼Œè™šæ‹Ÿæœºé‡‡ç”¨ä¸¤ç§æ–¹å¼æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼š

> **CAS+å¤±è´¥é‡è¯•**ï¼š CAS æ˜¯ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ã€‚æ‰€è°“ä¹è§‚é”å°±æ˜¯ï¼Œæ¯æ¬¡ä¸åŠ é”è€Œæ˜¯å‡è®¾æ²¡æœ‰å†²çªè€Œå»å®ŒæˆæŸé¡¹æ“ä½œï¼Œå¦‚æœå› ä¸ºå†²çªå¤±è´¥å°±é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚è™šæ‹Ÿæœºé‡‡ç”¨ CAS é…ä¸Šå¤±è´¥é‡è¯•çš„æ–¹å¼ä¿è¯æ›´æ–°æ“ä½œçš„åŸå­æ€§ã€‚  
> **TLAB**ï¼š ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹é¢„å…ˆåœ¨ Eden åŒºåˆ†é…ä¸€å—å†…å­˜ã€‚JVM åœ¨ç»™çº¿ç¨‹ä¸­çš„å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œé¦–å…ˆåœ¨ TLAB åˆ†é…ï¼Œå½“å¯¹è±¡å¤§äºTLAB ä¸­çš„å‰©ä½™å†…å­˜æˆ– TLAB çš„å†…å­˜å·²ç”¨å°½æ—¶ï¼Œå†é‡‡ç”¨ä¸Šè¿°çš„ CAS è¿›è¡Œå†…å­˜åˆ†é…ã€‚  

> **3. åˆå§‹åŒ–é›¶å€¼ï¼š** å†…å­˜åˆ†é…å®Œæˆåï¼Œè™šæ‹Ÿæœºéœ€è¦å°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼ˆä¸åŒ…æ‹¬å¯¹è±¡å¤´ï¼‰ï¼Œè¿™ä¸€æ­¥æ“ä½œä¿è¯äº†å¯¹è±¡çš„å®ä¾‹å­—æ®µåœ¨ Java ä»£ç ä¸­å¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿ç”¨ï¼Œç¨‹åºèƒ½è®¿é—®åˆ°è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„é›¶å€¼ã€‚

> **4. è®¾ç½®å¯¹è±¡å¤´ï¼š** åˆå§‹åŒ–é›¶å€¼å®Œæˆä¹‹åï¼Œè™šæ‹Ÿæœºè¦å¯¹å¯¹è±¡è¿›è¡Œå¿…è¦çš„è®¾ç½®ï¼Œä¾‹å¦‚è¿™ä¸ªå¯¹è±¡æ˜¯é‚£ä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œå—ã€å¯¹è±¡çš„ GC åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚ è¿™äº›ä¿¡æ¯å­˜æ”¾åœ¨å¯¹è±¡å¤´ä¸­ã€‚ å¦å¤–ï¼Œæ ¹æ®è™šæ‹Ÿæœºå½“å‰è¿è¡ŒçŠ¶æ€çš„ä¸åŒï¼Œå¦‚æ˜¯å¦å¯ç”¨åå‘é”ç­‰ï¼Œå¯¹è±¡å¤´ä¼šæœ‰ä¸åŒçš„è®¾ç½®æ–¹å¼ã€‚

> **5. æ‰§è¡Œ init æ–¹æ³•ï¼š** åœ¨ä¸Šé¢å·¥ä½œéƒ½å®Œæˆä¹‹åï¼Œä»è™šæ‹Ÿæœºçš„è§†è§’æ¥çœ‹ï¼Œä¸€ä¸ªæ–°çš„å¯¹è±¡å·²ç»äº§ç”Ÿäº†ï¼Œä½†ä» Java ç¨‹åºçš„è§†è§’æ¥çœ‹ï¼Œå¯¹è±¡åˆ›å»ºæ‰åˆšå¼€å§‹ï¼Œ<init> æ–¹æ³•è¿˜æ²¡æœ‰æ‰§è¡Œï¼Œæ‰€æœ‰çš„å­—æ®µéƒ½è¿˜ä¸ºé›¶ã€‚æ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œæ‰§è¡Œ new æŒ‡ä»¤ä¹‹åä¼šæ¥ç€æ‰§è¡Œ <init> æ–¹æ³•ï¼ŒæŠŠå¯¹è±¡æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„å¯¹è±¡æ‰ç®—å®Œå…¨äº§ç”Ÿå‡ºæ¥ã€‚

### 3.2 å¯¹è±¡çš„å†…å­˜å¸ƒå±€  
> åœ¨ Hotspot è™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€å¯ä»¥åˆ†ä¸º3å—åŒºåŸŸï¼šå¯¹è±¡å¤´ã€å®ä¾‹æ•°æ®å’Œå¯¹é½å¡«å……ã€‚

> Hotspotè™šæ‹Ÿæœºçš„å¯¹è±¡å¤´åŒ…æ‹¬ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼Œç¬¬ä¸€éƒ¨åˆ†ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è‡ªèº«è¿è¡Œæ—¶æ•°æ®ï¼ˆå“ˆå¸Œç ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ç­‰ç­‰ï¼‰ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯ç±»å‹æŒ‡é’ˆï¼Œå³å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚

> å®ä¾‹æ•°æ®éƒ¨åˆ†æ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼Œä¹Ÿæ˜¯åœ¨ç¨‹åºä¸­æ‰€å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µå†…å®¹ã€‚

> å¯¹é½å¡«å……éƒ¨åˆ†ä¸æ˜¯å¿…ç„¶å­˜åœ¨çš„ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å«ä¹‰ï¼Œä»…ä»…èµ·å ä½ä½œç”¨ã€‚ å› ä¸º Hotspot è™šæ‹Ÿæœºçš„è‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼Œæ¢å¥è¯è¯´å°±æ˜¯å¯¹è±¡çš„å¤§å°å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ã€‚è€Œå¯¹è±¡å¤´éƒ¨åˆ†æ­£å¥½æ˜¯8å­—èŠ‚çš„å€æ•°ï¼ˆ1å€æˆ–2å€ï¼‰ï¼Œå› æ­¤ï¼Œå½“å¯¹è±¡å®ä¾‹æ•°æ®éƒ¨åˆ†æ²¡æœ‰å¯¹é½æ—¶ï¼Œå°±éœ€è¦é€šè¿‡å¯¹é½å¡«å……æ¥è¡¥å…¨ã€‚

### 3.3 å¯¹è±¡çš„è®¿é—®å®šä½  
> å»ºç«‹å¯¹è±¡å°±æ˜¯ä¸ºäº†ä½¿ç”¨å¯¹è±¡ï¼Œæˆ‘ä»¬çš„Javaç¨‹åºé€šè¿‡æ ˆä¸Šçš„ reference æ•°æ®æ¥æ“ä½œå †ä¸Šçš„å…·ä½“å¯¹è±¡ã€‚å¯¹è±¡çš„è®¿é—®æ–¹å¼æœ‰è™šæ‹Ÿæœºå®ç°è€Œå®šï¼Œç›®å‰ä¸»æµçš„è®¿é—®æ–¹å¼æœ‰ä½¿ç”¨å¥æŸ„å’Œç›´æ¥æŒ‡é’ˆä¸¤ç§ï¼š

> **1. å¥æŸ„ï¼š** å¦‚æœä½¿ç”¨å¥æŸ„çš„è¯ï¼Œé‚£ä¹ˆ Java å †ä¸­å°†ä¼šåˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreference ä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè€Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®ä¸ç±»å‹æ•°æ®å„è‡ªçš„å…·ä½“åœ°å€ä¿¡æ¯ã€‚
![avatar](https://github.com/hyblogs/blogs/blob/master/Java_Images/Interview_Base/06.png)


> ä¸Šå›¾æ˜¯é€šè¿‡å¥æŸ„è®¿é—®å¯¹è±¡

> **2. ç›´æ¥æŒ‡é’ˆï¼š** å¦‚æœä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Œé‚£ä¹ˆ Java å †å¯¹è±¡çš„å¸ƒå±€ä¸­å°±å¿…é¡»è€ƒè™‘å¦‚ä½•æ”¾ç½®è®¿é—®ç±»å‹æ•°æ®çš„ç›¸å…³ä¿¡æ¯ï¼Œè€Œ reference ä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡çš„åœ°å€ã€‚
![avatar](https://github.com/hyblogs/blogs/blob/master/Java_Images/Interview_Base/07.png)


> ä¸Šå›¾æ˜¯é€šè¿‡ç›´æ¥æŒ‡é’ˆè®¿é—®å¯¹è±¡

> è¿™ä¸¤ç§å¯¹è±¡è®¿é—®æ–¹å¼å„æœ‰ä¼˜åŠ¿ã€‚ä½¿ç”¨å¥æŸ„æ¥è®¿é—®çš„æœ€å¤§å¥½å¤„æ˜¯ reference ä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„å¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡è¢«ç§»åŠ¨æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œè€Œ reference æœ¬èº«ä¸éœ€è¦ä¿®æ”¹ã€‚ä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®æ–¹å¼æœ€å¤§çš„å¥½å¤„å°±æ˜¯é€Ÿåº¦å¿«ï¼Œå®ƒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ã€‚

## 4 é‡ç‚¹è¡¥å……å†…å®¹  

### 4.1 String ç±»å’Œå¸¸é‡æ±   
> **1 String å¯¹è±¡çš„ä¸¤ç§åˆ›å»ºæ–¹å¼**

	String str1 = "abcd";
	String str2 = new String("abcd");
	System.out.println(str1==str2);//false
	
> è¿™ä¸¤ç§ä¸åŒçš„åˆ›å»ºæ–¹æ³•æ˜¯æœ‰å·®åˆ«çš„ï¼Œç¬¬ä¸€ç§æ–¹å¼æ˜¯åœ¨å¸¸é‡æ± ä¸­æ‹¿å¯¹è±¡ï¼Œç¬¬äºŒç§æ–¹å¼æ˜¯ç›´æ¥åœ¨å †å†…å­˜ç©ºé—´åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚  
![avatar](https://github.com/hyblogs/blogs/blob/master/Java_Images/Interview_Base/08.jpg)


> **è®°ä½**ï¼šåªè¦ä½¿ç”¨äº† new æ–¹æ³•ï¼Œå°±éœ€è¦åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚

> **2 String ç±»å‹çš„å¸¸é‡æ± æ¯”è¾ƒç‰¹æ®Šã€‚å®ƒçš„ä¸»è¦ä½¿ç”¨æ–¹æ³•æœ‰ä¸¤ç§ï¼š**

> + ç›´æ¥ä½¿ç”¨åŒå¼•å·å£°æ˜å‡ºæ¥çš„ String å¯¹è±¡ä¼šç›´æ¥å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ã€‚  
> + å¦‚æœä¸æ˜¯ç”¨åŒå¼•å·å£°æ˜çš„ String å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ String æä¾›çš„ intern æ–¹æ³•ã€‚String.intern() æ˜¯ä¸€ä¸ª Native æ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼šå¦‚æœè¿è¡Œæ—¶å¸¸é‡æ± ä¸­å·²ç»åŒ…å«ä¸€ä¸ªç­‰äºæ­¤ String å¯¹è±¡å†…å®¹çš„å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å›å¸¸é‡æ± ä¸­è¯¥å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­åˆ›å»ºä¸æ­¤ String å†…å®¹ç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›å¸¸é‡æ± ä¸­åˆ›å»ºçš„å­—ç¬¦ä¸²çš„å¼•ç”¨ã€‚
	
	String s1 = new String("è®¡ç®—æœº");
	String s2 = s1.intern();
	String s3 = "è®¡ç®—æœº";
	System.out.println(s2);//è®¡ç®—æœº
	System.out.println(s1 == s2);//falseï¼Œå› ä¸ºä¸€ä¸ªæ˜¯å †å†…å­˜ä¸­çš„Stringå¯¹è±¡,ä¸€ä¸ªæ˜¯å¸¸é‡æ± ä¸­	çš„Stringå¯¹è±¡
	System.out.println(s3 == s2);//trueï¼Œå› ä¸ºä¸¤ä¸ªéƒ½æ˜¯å¸¸é‡æ± ä¸­çš„Stringå¯¹è±¡
	
> **3 String å­—ç¬¦ä¸²æ‹¼æ¥**

	String str1 = "str";
	String str2 = "ing";
	 
	String str3 = "str" + "ing";//å¸¸é‡æ± ä¸­çš„å¯¹è±¡
	String str4 = str1 + str2; //åœ¨å †ä¸Šåˆ›å»ºçš„æ–°çš„å¯¹è±¡     
	String str5 = "string";//å¸¸é‡æ± ä¸­çš„å¯¹è±¡
	System.out.println(str3 == str4);//false
	System.out.println(str3 == str5);//true
	System.out.println(str4 == str5);//false
	
![avatar](https://github.com/hyblogs/blogs/blob/master/Java_Images/Interview_Base/09.png)

> å°½é‡é¿å…å¤šä¸ªå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå› ä¸ºè¿™æ ·ä¼šé‡æ–°åˆ›å»ºå¯¹è±¡ã€‚å¦‚æœéœ€è¦æ”¹å˜å­—ç¬¦ä¸²çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ StringBuilder(éçº¿ç¨‹å®‰å…¨ï¼Œé€Ÿåº¦å¿«) æˆ–è€… StringBuffer(çº¿ç¨‹å®‰å…¨ï¼Œé€Ÿåº¦æ…¢)ã€‚_(åœ¨ä¸è¦æ±‚çº¿ç¨‹å®‰å…¨çš„æƒ…å†µä¸‹ä½¿ç”¨StringBuilderï¼Œåœ¨è¦æ±‚çº¿ç¨‹å®‰å…¨çš„æƒ…å†µä¸‹ä½¿ç”¨StringBuffer)_

> é—®ï¼š

	String s1 = new String("abc"); // è¿™å¥è¯åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ï¼Ÿ
	
> ç­”ï¼š
> 	åˆ›å»ºäº†ä¸¤ä¸ªå¯¹è±¡ã€‚

> éªŒè¯ï¼š
	
	String s1 = new String("abc");// å †å†…å­˜çš„åœ°å€¼å€¼
	String s2 = "abc";
	System.out.println(s1 == s2);// è¾“å‡ºfalse,å› ä¸ºä¸€ä¸ªæ˜¯å †å†…å­˜ï¼Œä¸€ä¸ªæ˜¯å¸¸é‡æ± çš„å†…å­˜ï¼Œæ•…ä¸¤	è€…æ˜¯ä¸åŒçš„ã€‚
	System.out.println(s1.equals(s2));// è¾“å‡ºtrue
	
> **ç»“æœï¼š**

	false
	true
	
> **è§£é‡Šï¼š**

> å…ˆæœ‰å­—ç¬¦ä¸² â€œabcâ€ æ”¾å…¥å¸¸é‡æ± ï¼Œç„¶å new äº†ä¸€ä»½å­—ç¬¦ä¸² â€œabcâ€ æ”¾å…¥ Java å †ï¼ˆå­—ç¬¦ä¸²å¸¸é‡ â€œabcâ€ åœ¨ç¼–è¯‘æœŸå°±å·²ç»ç¡®å®šæ”¾å…¥å¸¸é‡æ± ï¼Œè€Œ Java å †ä¸Šçš„ â€œabcâ€ æ˜¯åœ¨è¿è¡ŒæœŸåˆå§‹åŒ–é˜¶æ®µæ‰ç¡®å®šï¼‰ï¼Œç„¶å Java æ ˆçš„ s1 æŒ‡å‘ Java å †ä¸Šçš„ â€œabcâ€ã€‚

### 4.2 8ç§åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å’Œå¸¸é‡æ± 
> Java åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»çš„å¤§éƒ¨åˆ†éƒ½å®ç°äº†å¸¸é‡æ± æŠ€æœ¯ï¼Œå³ Byteã€Shortã€Integerã€Longã€Characterã€Booleanï¼›è¿™5ç§åŒ…è£…ç±»é»˜è®¤åˆ›å»ºäº†æ•°å€¼ [-128ï¼Œ127] çš„ç›¸åº”ç±»å‹çš„ç¼“å­˜æ•°æ®ï¼Œä½†æ˜¯è¶…å‡ºæ­¤èŒƒå›´ä»ç„¶ä¼šå»åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚
ä¸¤ç§æµ®ç‚¹æ•°ç±»å‹çš„åŒ…è£…ç±» Floatã€Double å¹¶æ²¡æœ‰å®ç°å¸¸é‡æ± æŠ€æœ¯ã€‚
	
	Integer i1 = 33;
	Integer i2 = 33;
	System.out.println(i1 == i2);// è¾“å‡ºtrue
	Integer i11 = 333;
	Integer i22 = 333;
	System.out.println(i11 == i22);// è¾“å‡ºfalse
	Double i3 = 1.2;
	Double i4 = 1.2;
	System.out.println(i3 == i4);// è¾“å‡ºfalse
	
> Integer ç¼“å­˜æºä»£ç ï¼š
	
	/**
	 *æ­¤æ–¹æ³•å°†å§‹ç»ˆç¼“å­˜-128åˆ°127ï¼ˆåŒ…æ‹¬ç«¯ç‚¹ï¼‰èŒƒå›´å†…çš„å€¼ï¼Œå¹¶å¯ä»¥ç¼“å­˜æ­¤èŒƒå›´ä¹‹å¤–çš„å…¶ä»–å€¼ã€‚
	 */
	public static Integer valueOf(int i) {
	    if (i >= IntegerCache.low && i <= IntegerCache.high)
	        return IntegerCache.cache[i + (-IntegerCache.low)];
	    return new Integer(i);
	}
	
> åº”ç”¨åœºæ™¯ï¼š

	Integer i1=40ï¼›//Java åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šç›´æ¥å°†ä»£ç å°è£…æˆ Integer 	i1=Integer.valueOf(40);ä»è€Œä½¿ç”¨å¸¸é‡æ± ä¸­çš„å¯¹è±¡ã€‚
	
	Integer i1 = new Integer(40); //è¿™ç§æƒ…å†µä¸‹ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ã€‚
	
	Integer i1 = 40;
	Integer i2 = new Integer(40);
	System.out.println(i1==i2); //è¾“å‡ºfalse

> Integer æ¯”è¾ƒï¼ˆ==ï¼‰æ›´ä¸°å¯Œçš„ä¸€ä¸ªä¾‹å­ï¼š

	Integer i1 = 40;
	Integer i2 = 40;
	Integer i3 = 0;
	Integer i4 = new Integer(40);
	Integer i5 = new Integer(40);
	Integer i6 = new Integer(0);
	 
	System.out.println("i1=i2   " + (i1 == i2));
	System.out.println("i1=i2+i3   " + (i1 == i2 + i3));
	System.out.println("i1=i4   " + (i1 == i4));
	System.out.println("i4=i5   " + (i4 == i5));
	System.out.println("i4=i5+i6   " + (i4 == i5 + i6));   
	System.out.println("40=i5+i6   " + (40 == i5 + i6));

> **ç»“æœï¼š**
	
	i1=i2   true
	i1=i2+i3   true
	i1=i4   false
	i4=i5   false
	i4=i5+i6   true
	40=i5+i6   true
> **è§£é‡Šï¼š**  
è¯­å¥ i4 == i5 + i6ï¼Œå› ä¸º + è¿™ä¸ªæ“ä½œç¬¦ä¸é€‚ç”¨äº Integer å¯¹è±¡ï¼Œé¦–å…ˆ i5 å’Œ i6 è¿›è¡Œè‡ªåŠ¨æ‹†ç®±æ“ä½œï¼Œè¿›è¡Œæ•°å€¼ç›¸åŠ ï¼Œå³ i4 == 40ã€‚ç„¶åIntegerå¯¹è±¡æ— æ³•ä¸æ•°å€¼è¿›è¡Œç›´æ¥æ¯”è¾ƒï¼Œæ‰€ä»¥i4è‡ªåŠ¨æ‹†ç®±è½¬ä¸ºintå€¼40ï¼Œæœ€ç»ˆè¿™æ¡è¯­å¥è½¬ä¸º40 == 40è¿›è¡Œæ•°å€¼æ¯”è¾ƒã€‚


</p>


> ============================== æˆ‘æ˜¯å‹å¥½åˆ†å‰²çº¿ ==================================

<!--æ–‡ä¸­é“¾æ¥åœ°å€å¯¹åº”å±•ç¤ºæ•°æ®-->
> **ä»¥ä¸‹éƒ¨åˆ†æ˜¯æ–‡ä¸­é“¾æ¥å±•ç¤ºğŸ”—**

## Java8å†…å­˜æ¨¡å‹â€”æ°¸ä¹…ä»£(PermGen)å’Œå…ƒç©ºé—´(Metaspace)
> æœ¬ç« èŠ‚å†…å®¹æ‘˜è‡ªï¼šhttp://www.cnblogs.com/paddix/p/5309550.html

### ä¸€ã€JVM å†…å­˜æ¨¡å‹(è¿è¡Œæ—¶æ•°æ®åŒº)

> ã€€ã€€æ ¹æ® JVM è§„èŒƒï¼ŒJVM å†…å­˜å…±åˆ†ä¸ºè™šæ‹Ÿæœºæ ˆã€å †ã€æ–¹æ³•åŒºã€ç¨‹åºè®¡æ•°å™¨ã€æœ¬åœ°æ–¹æ³•æ ˆäº”ä¸ªéƒ¨åˆ†ã€‚
![avatar](https://github.com/hyblogs/blogs/blob/master/Java_Images/Interview_Base/10.png)


> ã€€ã€€**1ã€è™šæ‹Ÿæœºæ ˆ**ï¼šæ¯ä¸ªçº¿ç¨‹æœ‰ä¸€ä¸ªç§æœ‰çš„æ ˆï¼Œéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºã€‚æ ˆé‡Œé¢å­˜ç€çš„æ˜¯ä¸€ç§å«â€œæ ˆå¸§â€çš„ä¸œè¥¿ï¼Œæ¯ä¸ªæ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œæ ˆå¸§ä¸­å­˜æ”¾äº†å±€éƒ¨å˜é‡è¡¨ï¼ˆåŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡å¼•ç”¨ï¼‰ã€æ“ä½œæ•°æ ˆã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚æ ˆçš„å¤§å°å¯ä»¥å›ºå®šä¹Ÿå¯ä»¥åŠ¨æ€æ‰©å±•ã€‚å½“æ ˆè°ƒç”¨æ·±åº¦å¤§äºJVMæ‰€å…è®¸çš„èŒƒå›´ï¼Œä¼šæŠ›å‡ºStackOverflowErrorçš„é”™è¯¯ï¼Œä¸è¿‡è¿™ä¸ªæ·±åº¦èŒƒå›´ä¸æ˜¯ä¸€ä¸ªæ’å®šçš„å€¼ï¼Œæˆ‘ä»¬é€šè¿‡ä¸‹é¢è¿™æ®µç¨‹åºå¯ä»¥æµ‹è¯•ä¸€ä¸‹è¿™ä¸ªç»“æœï¼š

> æ ˆæº¢å‡ºæµ‹è¯•æºç ï¼š
	
	package com.paddx.test.memory;
	 
	public class StackErrorMock {
	    private static int index = 1;
	 
	    public void call(){
	        index++;
	        call();
	    }
	 
	    public static void main(String[] args) {
	        StackErrorMock mock = new StackErrorMock();
	        try {
	            mock.call();
	        }catch (Throwable e){
	            System.out.println("Stack deep : "+index);
	            e.printStackTrace();
	        }
	    }
	}
> ä»£ç æ®µ 1

> è¿è¡Œä¸‰æ¬¡ï¼Œå¯ä»¥çœ‹å‡ºæ¯æ¬¡æ ˆçš„æ·±åº¦éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹:
![avatar](https://github.com/hyblogs/blogs/blob/master/Java_Images/Interview_Base/11.png)


> è‡³äºçº¢è‰²æ¡†é‡Œçš„å€¼æ˜¯æ€ä¹ˆå‡ºæ¥çš„ï¼Œå°±éœ€è¦æ·±å…¥åˆ° JVM çš„æºç ä¸­æ‰èƒ½æ¢è®¨ï¼Œè¿™é‡Œä¸ä½œè¯¦ç»†é˜è¿°ã€‚

> è™šæ‹Ÿæœºæ ˆé™¤äº†ä¸Šè¿°é”™è¯¯å¤–ï¼Œè¿˜æœ‰å¦ä¸€ç§é”™è¯¯ï¼Œé‚£å°±æ˜¯å½“ç”³è¯·ä¸åˆ°ç©ºé—´æ—¶ï¼Œä¼šæŠ›å‡º OutOfMemoryErrorã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå°ç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œcatch æ•è·çš„æ˜¯ Throwableï¼Œè€Œä¸æ˜¯ Exceptionã€‚å› ä¸º StackOverflowError å’Œ OutOfMemoryError éƒ½ä¸å±äº Exception çš„å­ç±»ã€‚

> ã€€ã€€**2ã€æœ¬åœ°æ–¹æ³•æ ˆ**ï¼š

> ã€€ã€€è¿™éƒ¨åˆ†ä¸»è¦ä¸è™šæ‹Ÿæœºç”¨åˆ°çš„ Native æ–¹æ³•ç›¸å…³ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ Java åº”ç”¨ç¨‹åºå‘˜å¹¶ä¸éœ€è¦å…³å¿ƒè¿™éƒ¨åˆ†çš„å†…å®¹ã€‚

> ã€€ã€€**3ã€PC å¯„å­˜å™¨**ï¼š

> ã€€ã€€PC å¯„å­˜å™¨ï¼Œä¹Ÿå«ç¨‹åºè®¡æ•°å™¨ã€‚JVMæ”¯æŒå¤šä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ã€‚å€˜è‹¥å½“å‰æ‰§è¡Œçš„æ˜¯ JVM çš„æ–¹æ³•ï¼Œåˆ™è¯¥å¯„å­˜å™¨ä¸­ä¿å­˜å½“å‰æ‰§è¡ŒæŒ‡ä»¤çš„åœ°å€ï¼›å€˜è‹¥æ‰§è¡Œçš„æ˜¯native æ–¹æ³•ï¼Œåˆ™PCå¯„å­˜å™¨ä¸­ä¸ºç©ºã€‚

> ã€€ã€€**4ã€å †**

> ã€€ã€€å †å†…å­˜æ˜¯ JVM æ‰€æœ‰çº¿ç¨‹å…±äº«çš„éƒ¨åˆ†ï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨çš„æ—¶å€™å°±å·²ç»åˆ›å»ºã€‚æ‰€æœ‰çš„å¯¹è±¡å’Œæ•°ç»„éƒ½åœ¨å †ä¸Šè¿›è¡Œåˆ†é…ã€‚è¿™éƒ¨åˆ†ç©ºé—´å¯é€šè¿‡ GC è¿›è¡Œå›æ”¶ã€‚å½“ç”³è¯·ä¸åˆ°ç©ºé—´æ—¶ä¼šæŠ›å‡º OutOfMemoryErrorã€‚ä¸‹é¢æˆ‘ä»¬ç®€å•çš„æ¨¡æ‹Ÿä¸€ä¸ªå †å†…å­˜æº¢å‡ºçš„æƒ…å†µï¼š
	
	package com.paddx.test.memory;
	 
	import java.util.ArrayList;
	import java.util.List;
	 
	public class HeapOomMock {
	    public static void main(String[] args) {
	        List<byte[]> list = new ArrayList<byte[]>();
	        int i = 0;
	        boolean flag = true;
	        while (flag){
	            try {
	                i++;
	                list.add(new byte[1024 * 1024]);//æ¯æ¬¡å¢åŠ ä¸€ä¸ª1Må¤§å°çš„æ•°ç»„å¯¹è±¡
	            }catch (Throwable e){
	                e.printStackTrace();
	                flag = false;
	                System.out.println("count="+i);//è®°å½•è¿è¡Œçš„æ¬¡æ•°
	            }
	        }
	    }
	}
> ä»£ç æ®µ 2

> è¿è¡Œä¸Šè¿°ä»£ç ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼šã€€ã€€
![avatar](https://github.com/hyblogs/blogs/blob/master/Java_Images/Interview_Base/12.png)

<font color=red>
æ³¨æ„ï¼Œè¿™é‡Œæˆ‘æŒ‡å®šäº†å †å†…å­˜çš„å¤§å°ä¸º16Mï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹æ˜¾ç¤ºçš„count=14ï¼ˆè¿™ä¸ªæ•°å­—ä¸æ˜¯å›ºå®šçš„ï¼‰ï¼Œè‡³äºä¸ºä»€ä¹ˆä¼šæ˜¯14æˆ–å…¶ä»–æ•°å­—ï¼Œéœ€è¦æ ¹æ® GC æ—¥å¿—æ¥åˆ¤æ–­ã€‚
</font>
> ã€€ã€€**5ã€æ–¹æ³•åŒº**ï¼š

> ã€€ã€€æ–¹æ³•åŒºä¹Ÿæ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«ã€‚ä¸»è¦ç”¨äºå­˜å‚¨ç±»çš„ä¿¡æ¯ã€å¸¸é‡æ± ã€æ–¹æ³•æ•°æ®ã€æ–¹æ³•ä»£ç ç­‰ã€‚æ–¹æ³•åŒºé€»è¾‘ä¸Šå±äºå †çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯ä¸ºäº†ä¸å †è¿›è¡ŒåŒºåˆ†ï¼Œé€šå¸¸åˆå«â€œéå †â€ã€‚ 

### äºŒã€PermGenï¼ˆæ°¸ä¹…ä»£ï¼‰

> ã€€ã€€ç»å¤§éƒ¨åˆ† Java ç¨‹åºå‘˜åº”è¯¥éƒ½è§è¿‡ "java.lang.OutOfMemoryError: PermGen space "è¿™ä¸ªå¼‚å¸¸ã€‚è¿™é‡Œçš„ â€œPermGen spaceâ€å…¶å®æŒ‡çš„å°±æ˜¯æ–¹æ³•åŒºã€‚ä¸è¿‡æ–¹æ³•åŒºå’Œâ€œPermGen spaceâ€åˆæœ‰ç€æœ¬è´¨çš„åŒºåˆ«ã€‚å‰è€…æ˜¯ JVM çš„è§„èŒƒï¼Œè€Œåè€…åˆ™æ˜¯ JVM è§„èŒƒçš„ä¸€ç§å®ç°ï¼Œå¹¶ä¸”åªæœ‰ HotSpot æ‰æœ‰ â€œPermGen spaceâ€ï¼Œè€Œå¯¹äºå…¶ä»–ç±»å‹çš„è™šæ‹Ÿæœºï¼Œå¦‚ JRockitï¼ˆOracleï¼‰ã€J9ï¼ˆIBMï¼‰ å¹¶æ²¡æœ‰â€œPermGen spaceâ€ã€‚ç”±äºæ–¹æ³•åŒºä¸»è¦å­˜å‚¨ç±»çš„ç›¸å…³ä¿¡æ¯ï¼Œæ‰€ä»¥å¯¹äºåŠ¨æ€ç”Ÿæˆç±»çš„æƒ…å†µæ¯”è¾ƒå®¹æ˜“å‡ºç°æ°¸ä¹…ä»£çš„å†…å­˜æº¢å‡ºã€‚æœ€å…¸å‹çš„åœºæ™¯å°±æ˜¯ï¼Œåœ¨ jsp é¡µé¢æ¯”è¾ƒå¤šçš„æƒ…å†µï¼Œå®¹æ˜“å‡ºç°æ°¸ä¹…ä»£å†…å­˜æº¢å‡ºã€‚æˆ‘ä»¬ç°åœ¨é€šè¿‡åŠ¨æ€ç”Ÿæˆç±»æ¥æ¨¡æ‹Ÿ â€œPermGen spaceâ€çš„å†…å­˜æº¢å‡ºï¼š
	
	package com.paddx.test.memory;
	 
	public class Test {
	
	}
>  ä»£ç æ®µ 3

	package com.paddx.test.memory;
	 
	import java.io.File;
	import java.net.URL;
	import java.net.URLClassLoader;
	import java.util.ArrayList;
	import java.util.List;
	 
	public class PermGenOomMock{
	    public static void main(String[] args) {
	        URL url = null;
	        List<ClassLoader> classLoaderList = new ArrayList<ClassLoader>();
	        try {
	            url = new File("/tmp").toURI().toURL();
	            URL[] urls = {url};
	            while (true){
	                ClassLoader loader = new URLClassLoader(urls);
	                classLoaderList.add(loader);
	                loader.loadClass("com.paddx.test.memory.Test");
	            }
	        } catch (Exception e) {
	            e.printStackTrace();
	        }
	    }
	}
> ä»£ç æ®µ 4

> è¿è¡Œç»“æœå¦‚ä¸‹ï¼š
![avatar](https://github.com/hyblogs/blogs/blob/master/Java_Images/Interview_Base/13.png)

> ã€€ã€€æœ¬ä¾‹ä¸­ä½¿ç”¨çš„ JDK ç‰ˆæœ¬æ˜¯ 1.7ï¼ŒæŒ‡å®šçš„ PermGen åŒºçš„å¤§å°ä¸º 8Mã€‚é€šè¿‡æ¯æ¬¡ç”Ÿæˆä¸åŒURLClassLoaderå¯¹è±¡æ¥åŠ è½½Testç±»ï¼Œä»è€Œç”Ÿæˆä¸åŒçš„ç±»å¯¹è±¡ï¼Œè¿™æ ·å°±èƒ½çœ‹åˆ°æˆ‘ä»¬ç†Ÿæ‚‰çš„ "java.lang.OutOfMemoryError: PermGen space " å¼‚å¸¸äº†ã€‚è¿™é‡Œä¹‹æ‰€ä»¥é‡‡ç”¨ JDK 1.7ï¼Œæ˜¯å› ä¸ºåœ¨ JDK 1.8 ä¸­ï¼Œ HotSpot å·²ç»æ²¡æœ‰ â€œPermGen spaceâ€è¿™ä¸ªåŒºé—´äº†ï¼Œå–è€Œä»£ä¹‹æ˜¯ä¸€ä¸ªå«åš Metaspaceï¼ˆå…ƒç©ºé—´ï¼‰ çš„ä¸œè¥¿ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹ Metaspace ä¸ PermGen space çš„åŒºåˆ«ã€‚

### ä¸‰ã€Metaspaceï¼ˆå…ƒç©ºé—´ï¼‰

> ã€€ã€€å…¶å®ï¼Œç§»é™¤æ°¸ä¹…ä»£çš„å·¥ä½œä»JDK1.7å°±å¼€å§‹äº†ã€‚JDK1.7ä¸­ï¼Œå­˜å‚¨åœ¨æ°¸ä¹…ä»£çš„éƒ¨åˆ†æ•°æ®å°±å·²ç»è½¬ç§»åˆ°äº†Java Heapæˆ–è€…æ˜¯ Native Heapã€‚ä½†æ°¸ä¹…ä»£ä»å­˜åœ¨äºJDK1.7ä¸­ï¼Œå¹¶æ²¡å®Œå…¨ç§»é™¤ï¼Œè­¬å¦‚ç¬¦å·å¼•ç”¨(Symbols)è½¬ç§»åˆ°äº†native heapï¼›å­—é¢é‡(interned strings)è½¬ç§»åˆ°äº†java heapï¼›ç±»çš„é™æ€å˜é‡(class statics)è½¬ç§»åˆ°äº†java heapã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€æ®µç¨‹åºæ¥æ¯”è¾ƒ JDK 1.6 ä¸ JDK 1.7åŠ JDK 1.8 çš„åŒºåˆ«ï¼Œä»¥å­—ç¬¦ä¸²å¸¸é‡ä¸ºä¾‹ï¼š
	
	package com.paddx.test.memory;
	 
	import java.util.ArrayList;
	import java.util.List;
	 
	public class StringOomMock {
	    static String  base = "string";
	    public static void main(String[] args) {
	        List<String> list = new ArrayList<String>();
	        for (int i=0;i< Integer.MAX_VALUE;i++){
	            String str = base + base;
	            base = str;
	            list.add(str.intern());
	        }
	    }
	}
> è¿™æ®µç¨‹åºä»¥2çš„æŒ‡æ•°çº§ä¸æ–­çš„ç”Ÿæˆæ–°çš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·å¯ä»¥æ¯”è¾ƒå¿«é€Ÿçš„æ¶ˆè€—å†…å­˜ã€‚æˆ‘ä»¬é€šè¿‡ JDK 1.6ã€JDK 1.7 å’Œ JDK 1.8 åˆ†åˆ«è¿è¡Œï¼š

> JDK 1.6 çš„è¿è¡Œç»“æœï¼š
![avatar](https://github.com/hyblogs/blogs/blob/master/Java_Images/Interview_Base/14.png)


> JDK 1.7çš„è¿è¡Œç»“æœï¼š
![avatar](https://github.com/hyblogs/blogs/blob/master/Java_Images/Interview_Base/15.png)


> JDK 1.8çš„è¿è¡Œç»“æœï¼š
![avatar](https://github.com/hyblogs/blogs/blob/master/Java_Images/Interview_Base/16.png)


> ã€€ã€€ä»ä¸Šè¿°ç»“æœå¯ä»¥çœ‹å‡ºï¼ŒJDK 1.6ä¸‹ï¼Œä¼šå‡ºç°â€œPermGen Spaceâ€çš„å†…å­˜æº¢å‡ºï¼Œè€Œåœ¨ JDK 1.7å’Œ JDK 1.8 ä¸­ï¼Œä¼šå‡ºç°å †å†…å­˜æº¢å‡ºï¼Œå¹¶ä¸” JDK 1.8ä¸­ PermSize å’Œ MaxPermGen å·²ç»æ— æ•ˆã€‚å› æ­¤ï¼Œå¯ä»¥å¤§è‡´éªŒè¯ JDK 1.7 å’Œ 1.8 å°†å­—ç¬¦ä¸²å¸¸é‡ç”±æ°¸ä¹…ä»£è½¬ç§»åˆ°å †ä¸­ï¼Œå¹¶ä¸” JDK 1.8 ä¸­å·²ç»ä¸å­˜åœ¨æ°¸ä¹…ä»£çš„ç»“è®ºã€‚ç°åœ¨æˆ‘ä»¬çœ‹çœ‹å…ƒç©ºé—´åˆ°åº•æ˜¯ä¸€ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Ÿ

> ã€€ã€€å…ƒç©ºé—´çš„æœ¬è´¨å’Œæ°¸ä¹…ä»£ç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹JVMè§„èŒƒä¸­æ–¹æ³•åŒºçš„å®ç°ã€‚ä¸è¿‡å…ƒç©ºé—´ä¸æ°¸ä¹…ä»£ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼šå…ƒç©ºé—´å¹¶ä¸åœ¨è™šæ‹Ÿæœºä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒç©ºé—´çš„å¤§å°ä»…å—æœ¬åœ°å†…å­˜é™åˆ¶ï¼Œä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹å‚æ•°æ¥æŒ‡å®šå…ƒç©ºé—´çš„å¤§å°ï¼š

> ã€€ã€€-XX:MetaspaceSizeï¼Œåˆå§‹ç©ºé—´å¤§å°ï¼Œè¾¾åˆ°è¯¥å€¼å°±ä¼šè§¦å‘åƒåœ¾æ”¶é›†è¿›è¡Œç±»å‹å¸è½½ï¼ŒåŒæ—¶GCä¼šå¯¹è¯¥å€¼è¿›è¡Œè°ƒæ•´ï¼šå¦‚æœé‡Šæ”¾äº†å¤§é‡çš„ç©ºé—´ï¼Œå°±é€‚å½“é™ä½è¯¥å€¼ï¼›å¦‚æœé‡Šæ”¾äº†å¾ˆå°‘çš„ç©ºé—´ï¼Œé‚£ä¹ˆåœ¨ä¸è¶…è¿‡MaxMetaspaceSizeæ—¶ï¼Œé€‚å½“æé«˜è¯¥å€¼ã€‚  
> ã€€ã€€-XX:MaxMetaspaceSizeï¼Œæœ€å¤§ç©ºé—´ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰é™åˆ¶çš„ã€‚

> ã€€ã€€é™¤äº†ä¸Šé¢ä¸¤ä¸ªæŒ‡å®šå¤§å°çš„é€‰é¡¹ä»¥å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªä¸ GC ç›¸å…³çš„å±æ€§ï¼š
> ã€€ã€€-XX:MinMetaspaceFreeRatioï¼Œåœ¨GCä¹‹åï¼Œæœ€å°çš„Metaspaceå‰©ä½™ç©ºé—´å®¹é‡çš„ç™¾åˆ†æ¯”ï¼Œå‡å°‘ä¸ºåˆ†é…ç©ºé—´æ‰€å¯¼è‡´çš„åƒåœ¾æ”¶é›†.  
> ã€€ã€€-XX:MaxMetaspaceFreeRatioï¼Œåœ¨GCä¹‹åï¼Œæœ€å¤§çš„Metaspaceå‰©ä½™ç©ºé—´å®¹é‡çš„ç™¾åˆ†æ¯”ï¼Œå‡å°‘ä¸ºé‡Šæ”¾ç©ºé—´æ‰€å¯¼è‡´çš„åƒåœ¾æ”¶é›†.  

> ç°åœ¨æˆ‘ä»¬åœ¨ JDK 8ä¸‹é‡æ–°è¿è¡Œä¸€ä¸‹ä»£ç æ®µ 4ï¼Œä¸è¿‡è¿™æ¬¡ä¸å†æŒ‡å®š PermSize å’Œ MaxPermSizeã€‚è€Œæ˜¯æŒ‡å®š MetaSpaceSize å’Œ MaxMetaSpaceSizeçš„å¤§å°ã€‚è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š
![avatar](https://github.com/hyblogs/blogs/blob/master/Java_Images/Interview_Base/17.png)


> ä»è¾“å‡ºç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¿™æ¬¡ä¸å†å‡ºç°æ°¸ä¹…ä»£æº¢å‡ºï¼Œè€Œæ˜¯å‡ºç°äº†å…ƒç©ºé—´çš„æº¢å‡ºã€‚

### å››ã€æ€»ç»“

> ã€€ã€€é€šè¿‡ä¸Šé¢åˆ†æï¼Œå¤§å®¶åº”è¯¥å¤§è‡´äº†è§£äº† JVM çš„å†…å­˜åˆ’åˆ†ï¼Œä¹Ÿæ¸…æ¥šäº† JDK 8 ä¸­æ°¸ä¹…ä»£å‘å…ƒç©ºé—´çš„è½¬æ¢ã€‚ä¸è¿‡å¤§å®¶åº”è¯¥éƒ½æœ‰ä¸€ä¸ªç–‘é—®ï¼Œå°±æ˜¯ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªè½¬æ¢ï¼Ÿæ‰€ä»¥ï¼Œæœ€åç»™å¤§å®¶æ€»ç»“ä»¥ä¸‹å‡ ç‚¹åŸå› ï¼š

> ã€€ã€€1ã€å­—ç¬¦ä¸²å­˜åœ¨æ°¸ä¹…ä»£ä¸­ï¼Œå®¹æ˜“å‡ºç°æ€§èƒ½é—®é¢˜å’Œå†…å­˜æº¢å‡ºã€‚

> ã€€ã€€2ã€ç±»åŠæ–¹æ³•çš„ä¿¡æ¯ç­‰æ¯”è¾ƒéš¾ç¡®å®šå…¶å¤§å°ï¼Œå› æ­¤å¯¹äºæ°¸ä¹…ä»£çš„å¤§å°æŒ‡å®šæ¯”è¾ƒå›°éš¾ï¼Œå¤ªå°å®¹æ˜“å‡ºç°æ°¸ä¹…ä»£æº¢å‡ºï¼Œå¤ªå¤§åˆ™å®¹æ˜“å¯¼è‡´è€å¹´ä»£æº¢å‡ºã€‚

> ã€€ã€€3ã€æ°¸ä¹…ä»£ä¼šä¸º GC å¸¦æ¥ä¸å¿…è¦çš„å¤æ‚åº¦ï¼Œå¹¶ä¸”å›æ”¶æ•ˆç‡åä½ã€‚

> ã€€ã€€4ã€Oracle å¯èƒ½ä¼šå°†HotSpot ä¸ JRockit åˆäºŒä¸ºä¸€ã€‚




## Javaä¸­å‡ ç§å¸¸é‡æ± çš„åŒºåˆ†
> æœ¬ç« èŠ‚å†…å®¹æ‘˜è‡ªï¼šhttp://tangxman.github.io/2015/07/27/the-difference-of-java-string-pool/

> åœ¨javaçš„å†…å­˜åˆ†é…ä¸­ï¼Œç»å¸¸å¬åˆ°å¾ˆå¤šå…³äºå¸¸é‡æ± çš„æè¿°ï¼Œæˆ‘å¼€å§‹çœ‹çš„æ—¶å€™ä¹Ÿæ˜¯çœ‹çš„å¾ˆæ¨¡ç³Šï¼Œç½‘ä¸Šäº”èŠ±å…«é—¨çš„è¯´æ³•ç®€ç›´å¤ªå¤šäº†ï¼Œæœ€åæŸ¥é˜…å„ç§èµ„æ–™ï¼Œç»ˆäºç®—æ˜¯å·®ä¸å¤šç†æ¸…äº†ï¼Œå¾ˆå¤šç½‘ä¸Šè¯´æ³•éƒ½æœ‰é—®é¢˜ï¼Œç¬”è€…å°è¯•ç€æ¥åŒºåˆ†ä¸€ä¸‹è¿™å‡ ä¸ªæ¦‚å¿µã€‚

### 1.å…¨å±€å­—ç¬¦ä¸²æ± ï¼ˆstring poolä¹Ÿæœ‰å«åšstring literal poolï¼‰

> å…¨å±€å­—ç¬¦ä¸²æ± é‡Œçš„å†…å®¹æ˜¯åœ¨ç±»åŠ è½½å®Œæˆï¼Œç»è¿‡éªŒè¯ï¼Œå‡†å¤‡é˜¶æ®µä¹‹ååœ¨å †ä¸­ç”Ÿæˆå­—ç¬¦ä¸²å¯¹è±¡å®ä¾‹ï¼Œç„¶åå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡å®ä¾‹çš„å¼•ç”¨å€¼å­˜åˆ°string poolä¸­ï¼ˆ**è®°ä½ï¼šstring poolä¸­å­˜çš„æ˜¯å¼•ç”¨å€¼è€Œä¸æ˜¯å…·ä½“çš„å®ä¾‹å¯¹è±¡ï¼Œå…·ä½“çš„å®ä¾‹å¯¹è±¡æ˜¯åœ¨å †ä¸­å¼€è¾Ÿçš„ä¸€å—ç©ºé—´å­˜æ”¾çš„ã€‚**ï¼‰ã€‚  
åœ¨HotSpot VMé‡Œå®ç°çš„string poolåŠŸèƒ½çš„æ˜¯ä¸€ä¸ªStringTableç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œé‡Œé¢å­˜çš„æ˜¯é©»ç•™å­—ç¬¦ä¸²(ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ç”¨åŒå¼•å·æ‹¬èµ·æ¥çš„)çš„å¼•ç”¨ï¼ˆè€Œä¸æ˜¯é©»ç•™å­—ç¬¦ä¸²å®ä¾‹æœ¬èº«ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å †ä¸­çš„æŸäº›å­—ç¬¦ä¸²å®ä¾‹è¢«è¿™ä¸ªStringTableå¼•ç”¨ä¹‹åå°±ç­‰åŒè¢«èµ‹äºˆäº†â€é©»ç•™å­—ç¬¦ä¸²â€çš„èº«ä»½ã€‚è¿™ä¸ªStringTableåœ¨æ¯ä¸ªHotSpot VMçš„å®ä¾‹åªæœ‰ä¸€ä»½ï¼Œè¢«æ‰€æœ‰çš„ç±»å…±äº«ã€‚

### 2.classæ–‡ä»¶å¸¸é‡æ± ï¼ˆclass constant poolï¼‰

> æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œclassæ–‡ä»¶ä¸­é™¤äº†åŒ…å«ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰ä¸€é¡¹ä¿¡æ¯å°±æ˜¯å¸¸é‡æ± (constant pool table)ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘å™¨ç”Ÿæˆçš„å„ç§å­—é¢é‡(Literal)å’Œç¬¦å·å¼•ç”¨(Symbolic References)ã€‚  
å­—é¢é‡å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å¸¸é‡æ¦‚å¿µï¼Œå¦‚æ–‡æœ¬å­—ç¬¦ä¸²ã€è¢«å£°æ˜ä¸ºfinalçš„å¸¸é‡å€¼ç­‰ã€‚  
ç¬¦å·å¼•ç”¨æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦ä½¿ç”¨æ—¶èƒ½æ— æ­§ä¹‰åœ°å®šä½åˆ°ç›®æ ‡å³å¯ï¼ˆå®ƒä¸ç›´æ¥å¼•ç”¨åŒºåˆ†ä¸€ä¸‹ï¼Œç›´æ¥å¼•ç”¨ä¸€èˆ¬æ˜¯æŒ‡å‘æ–¹æ³•åŒºçš„æœ¬åœ°æŒ‡é’ˆï¼Œç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ï¼‰ã€‚  

> ä¸€èˆ¬åŒ…æ‹¬ä¸‹é¢ä¸‰ç±»å¸¸é‡ï¼š
>
+ ç±»å’Œæ¥å£çš„å…¨é™å®šå
+ å­—æ®µçš„åç§°å’Œæè¿°ç¬¦
+ æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦

> å¸¸é‡æ± çš„æ¯ä¸€é¡¹å¸¸é‡éƒ½æ˜¯ä¸€ä¸ªè¡¨ï¼Œä¸€å…±æœ‰å¦‚ä¸‹è¡¨æ‰€ç¤ºçš„11ç§å„ä¸ç›¸åŒçš„è¡¨ç»“æ„æ•°æ®ï¼Œè¿™æ¯ä¸ªè¡¨å¼€å§‹çš„ç¬¬ä¸€ä½éƒ½æ˜¯ä¸€ä¸ªå­—èŠ‚çš„æ ‡å¿—ä½ï¼ˆå–å€¼1-12ï¼‰ï¼Œä»£è¡¨å½“å‰è¿™ä¸ªå¸¸é‡å±äºå“ªç§å¸¸é‡ç±»å‹ã€‚
![avatar](https://github.com/hyblogs/blogs/blob/master/Java_Images/Interview_Base/18.png)

æ¯ç§ä¸åŒç±»å‹çš„å¸¸é‡ç±»å‹å…·æœ‰ä¸åŒçš„ç»“æ„ï¼Œå…·ä½“çš„ç»“æ„æœ¬æ–‡å°±å…ˆä¸å™è¿°äº†ï¼Œæœ¬æ–‡ç€é‡åŒºåˆ†è¿™ä¸‰ä¸ªå¸¸é‡æ± çš„æ¦‚å¿µï¼ˆè¯»è€…è‹¥æƒ³æ·±å…¥äº†è§£æ¯ç§å¸¸é‡ç±»å‹çš„æ•°æ®ç»“æ„å¯ä»¥æŸ¥çœ‹ã€Šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºã€‹ç¬¬å…­ç« çš„å†…å®¹ï¼‰ã€‚

### 3.è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆruntime constant poolï¼‰

> å½“javaæ–‡ä»¶è¢«ç¼–è¯‘æˆclassæ–‡ä»¶ä¹‹åï¼Œä¹Ÿå°±æ˜¯ä¼šç”Ÿæˆæˆ‘ä¸Šé¢æ‰€è¯´çš„classå¸¸é‡æ± ï¼Œé‚£ä¹ˆè¿è¡Œæ—¶å¸¸é‡æ± åˆæ˜¯ä»€ä¹ˆæ—¶å€™äº§ç”Ÿçš„å‘¢ï¼Ÿ

> jvmåœ¨æ‰§è¡ŒæŸä¸ªç±»çš„æ—¶å€™ï¼Œå¿…é¡»ç»è¿‡åŠ è½½ã€è¿æ¥ã€åˆå§‹åŒ–ï¼Œè€Œè¿æ¥åˆåŒ…æ‹¬éªŒè¯ã€å‡†å¤‡ã€è§£æä¸‰ä¸ªé˜¶æ®µã€‚è€Œå½“ç±»åŠ è½½åˆ°å†…å­˜ä¸­åï¼Œjvmå°±ä¼šå°†classå¸¸é‡æ± ä¸­çš„å†…å®¹å­˜æ”¾åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œç”±æ­¤å¯çŸ¥ï¼Œè¿è¡Œæ—¶å¸¸é‡æ± ä¹Ÿæ˜¯æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªã€‚åœ¨ä¸Šé¢æˆ‘ä¹Ÿè¯´äº†ï¼Œclasså¸¸é‡æ± ä¸­å­˜çš„æ˜¯å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–ä»¬å­˜çš„å¹¶ä¸æ˜¯å¯¹è±¡çš„å®ä¾‹ï¼Œè€Œæ˜¯å¯¹è±¡çš„ç¬¦å·å¼•ç”¨å€¼ã€‚è€Œç»è¿‡è§£æï¼ˆresolveï¼‰ä¹‹åï¼Œä¹Ÿå°±æ˜¯æŠŠç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œè§£æçš„è¿‡ç¨‹ä¼šå»æŸ¥è¯¢å…¨å±€å­—ç¬¦ä¸²æ± ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„StringTableï¼Œä»¥ä¿è¯è¿è¡Œæ—¶å¸¸é‡æ± æ‰€å¼•ç”¨çš„å­—ç¬¦ä¸²ä¸å…¨å±€å­—ç¬¦ä¸²æ± ä¸­æ‰€å¼•ç”¨çš„æ˜¯ä¸€è‡´çš„ã€‚

> ä¸¾ä¸ªå®ä¾‹æ¥è¯´æ˜ä¸€ä¸‹:
	
	String str1 = "abc";
	String str2 = new String("def");
	String str3 = "abc";
	String str4 = str2.intern();
	String str5 = "def";
	System.out.println(str1 == str3);//true
	System.out.println(str2 == str4);//false
	System.out.println(str4 == str5);//true
	
> ä¸Šé¢ç¨‹åºçš„é¦–å…ˆç»è¿‡ç¼–è¯‘ä¹‹åï¼Œåœ¨è¯¥ç±»çš„classå¸¸é‡æ± ä¸­å­˜æ”¾ä¸€äº›ç¬¦å·å¼•ç”¨ï¼Œç„¶åç±»åŠ è½½ä¹‹åï¼Œå°†classå¸¸é‡æ± ä¸­å­˜æ”¾çš„ç¬¦å·å¼•ç”¨è½¬å­˜åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œç„¶åç»è¿‡éªŒè¯ï¼Œå‡†å¤‡é˜¶æ®µä¹‹åï¼Œåœ¨å †ä¸­ç”Ÿæˆé©»ç•™å­—ç¬¦ä¸²çš„å®ä¾‹å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯ä¸Šä¾‹ä¸­str1æ‰€æŒ‡å‘çš„â€abcâ€å®ä¾‹å¯¹è±¡ï¼‰ï¼Œç„¶åå°†è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨å­˜åˆ°å…¨å±€String Poolä¸­ï¼Œä¹Ÿå°±æ˜¯StringTableä¸­ï¼Œæœ€ååœ¨è§£æé˜¶æ®µï¼Œè¦æŠŠè¿è¡Œæ—¶å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢æˆç›´æ¥å¼•ç”¨ï¼Œé‚£ä¹ˆå°±ç›´æ¥æŸ¥è¯¢StringTableï¼Œä¿è¯StringTableé‡Œçš„å¼•ç”¨å€¼ä¸è¿è¡Œæ—¶å¸¸é‡æ± ä¸­çš„å¼•ç”¨å€¼ä¸€è‡´ï¼Œå¤§æ¦‚æ•´ä¸ªè¿‡ç¨‹å°±æ˜¯è¿™æ ·äº†ã€‚

> å›åˆ°ä¸Šé¢çš„é‚£ä¸ªç¨‹åºï¼Œç°åœ¨å°±å¾ˆå®¹æ˜“è§£é‡Šæ•´ä¸ªç¨‹åºçš„å†…å­˜åˆ†é…è¿‡ç¨‹äº†ï¼Œé¦–å…ˆï¼Œåœ¨å †ä¸­ä¼šæœ‰ä¸€ä¸ªâ€abcâ€å®ä¾‹ï¼Œå…¨å±€StringTableä¸­å­˜æ”¾ç€â€abcâ€çš„ä¸€ä¸ªå¼•ç”¨å€¼ï¼Œç„¶ååœ¨è¿è¡Œç¬¬äºŒå¥çš„æ—¶å€™ä¼šç”Ÿæˆä¸¤ä¸ªå®ä¾‹ï¼Œä¸€ä¸ªæ˜¯â€defâ€çš„å®ä¾‹å¯¹è±¡ï¼Œå¹¶ä¸”StringTableä¸­å­˜å‚¨ä¸€ä¸ªâ€defâ€çš„å¼•ç”¨å€¼ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯newå‡ºæ¥çš„ä¸€ä¸ªâ€defâ€çš„å®ä¾‹å¯¹è±¡ï¼Œä¸ä¸Šé¢é‚£ä¸ªæ˜¯ä¸åŒçš„å®ä¾‹ï¼Œå½“åœ¨è§£æstr3çš„æ—¶å€™æŸ¥æ‰¾StringTableï¼Œé‡Œé¢æœ‰â€abcâ€çš„å…¨å±€é©»ç•™å­—ç¬¦ä¸²å¼•ç”¨ï¼Œæ‰€ä»¥str3çš„å¼•ç”¨åœ°å€ä¸ä¹‹å‰çš„é‚£ä¸ªå·²å­˜åœ¨çš„ç›¸åŒï¼Œstr4æ˜¯åœ¨è¿è¡Œçš„æ—¶å€™è°ƒç”¨intern()å‡½æ•°ï¼Œè¿”å›StringTableä¸­â€defâ€çš„å¼•ç”¨å€¼ï¼Œå¦‚æœæ²¡æœ‰å°±å°†str2çš„å¼•ç”¨å€¼æ·»åŠ è¿›å»ï¼Œåœ¨è¿™é‡Œï¼ŒStringTableä¸­å·²ç»æœ‰äº†â€defâ€çš„å¼•ç”¨å€¼äº†ï¼Œæ‰€ä»¥è¿”å›ä¸Šé¢åœ¨new str2çš„æ—¶å€™æ·»åŠ åˆ°StringTableä¸­çš„ â€œdefâ€å¼•ç”¨å€¼ï¼Œæœ€åstr5åœ¨è§£æçš„æ—¶å€™å°±ä¹Ÿæ˜¯æŒ‡å‘å­˜åœ¨äºStringTableä¸­çš„â€defâ€çš„å¼•ç”¨å€¼ï¼Œé‚£ä¹ˆè¿™æ ·ä¸€åˆ†æä¹‹åï¼Œä¸‹é¢ä¸‰ä¸ªæ‰“å°çš„å€¼å°±å®¹æ˜“ç†è§£äº†ã€‚

> **æ€»ç»“**  
1.å…¨å±€å¸¸é‡æ± åœ¨æ¯ä¸ªVMä¸­åªæœ‰ä¸€ä»½ï¼Œå­˜æ”¾çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡çš„å¼•ç”¨å€¼ã€‚  
2.classå¸¸é‡æ± æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™æ¯ä¸ªclasséƒ½æœ‰çš„ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µï¼Œå­˜æ”¾çš„æ˜¯å¸¸é‡çš„ç¬¦å·å¼•ç”¨ã€‚  
3.è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯åœ¨ç±»åŠ è½½å®Œæˆä¹‹åï¼Œå°†æ¯ä¸ªclasså¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨å€¼è½¬å­˜åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªclasséƒ½æœ‰ä¸€ä¸ªè¿è¡Œæ—¶å¸¸é‡æ± ï¼Œç±»åœ¨è§£æä¹‹åï¼Œå°†ç¬¦å·å¼•ç”¨æ›¿æ¢æˆç›´æ¥å¼•ç”¨ï¼Œä¸å…¨å±€å¸¸é‡æ± ä¸­çš„å¼•ç”¨å€¼ä¿æŒä¸€è‡´ã€‚  
